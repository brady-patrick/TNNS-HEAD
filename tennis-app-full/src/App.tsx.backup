import React, { useMemo, useState, useContext, createContext, cloneElement, useEffect, memo } from "react";
import {
  BarChart2,
  ChevronDown,
  Video,
  Upload,
  Paperclip,
  Sparkles,
  MessageSquare,
  MapPin,
  Calendar,
  Trophy,
  ArrowLeft,
  Home,
  TrendingUp,
  TrendingDown,
  X,
} from "lucide-react";
import { Navigation } from "./components/Navigation";
import { TennisStatsDrawer } from "./components/StatsDrawer";

// ============================================================
// Minimal local UI primitives (anonymized) so the file runs
// ============================================================
const cn = (...c: Array<string | undefined | false>) => c.filter(Boolean).join(" ");

export function Button({ variant = "default", size = "md", className, children, ...props }: any) {
  const variants: any = {
    default: "bg-primary text-primary-foreground",
    secondary: "bg-muted text-foreground",
    ghost: "bg-transparent",
    link: "bg-transparent underline",
    outline: "border",
  };
  const sizes: any = { sm: "h-8 px-3 text-sm", md: "h-9 px-4", lg: "h-10 px-5" };
  return (
    <button className={cn("inline-flex items-center justify-center rounded-xl shadow-sm transition gap-1", variants[variant] || "", sizes[size] || "", className)} {...props}>
      {children}
    </button>
  );
}

export function Card({ className, ...props }: any) { return <div className={cn("rounded-2xl border bg-card", className)} {...props} />; }
export function CardHeader({ className, ...props }: any) { return <div className={cn("p-4", className)} {...props} />; }
export function CardTitle({ className, ...props }: any) { return <h3 className={cn("text-lg font-semibold", className)} {...props} />; }
export function CardDescription({ className, ...props }: any) { return <p className={cn("text-sm text-muted-foreground", className)} {...props} />; }
export function CardContent({ className, ...props }: any) { return <div className={cn("p-4 pt-0", className)} {...props} />; }

export function Input({ className, ...props }: any) { return <input className={cn("h-9 w-full rounded-xl border px-3 text-sm", className)} {...props} />; }
export function Textarea({ className, ...props }: any) { return <textarea className={cn("min-h-[44px] w-full rounded-xl border p-3 text-sm", className)} {...props} />; }
export function Badge({ className, ...props }: any) { return <span className={cn("inline-flex items-center rounded-full border px-2 py-0.5 text-xs", className)} {...props} />; }
export function Separator({ className, ...props }: any) { return <div className={cn("my-2 h-px w-full bg-border", className)} {...props} />; }
export function Label({ className, ...props }: any) { return <label className={cn("text-sm font-medium", className)} {...props} />; }
export function Switch({ defaultChecked, onChange }: any) { return <input type="checkbox" defaultChecked={defaultChecked} onChange={onChange} className="h-5 w-9 cursor-pointer appearance-none rounded-full bg-muted outline-none transition checked:bg-primary" />; }

export function Avatar({ className, children }: any) { return <div className={cn("relative inline-flex items-center justify-center overflow-hidden rounded-full bg-muted", className)}>{children}</div>; }
export function AvatarImage({ src, alt }: any) { return src ? <img src={src} alt={alt} className="h-full w-full object-cover" loading="lazy" decoding="async" /> : null; }
export function AvatarFallback({ children }: any) { return <span className="text-xs text-muted-foreground">{children}</span>; }

// --- Simple Dialog ---
const DialogCtx = createContext<{ open: boolean; setOpen: (v: boolean) => void } | null>(null);
export function Dialog({ open, onOpenChange, children }: any) {
  const [local, setLocal] = useState(!!open);
  const setOpen = (v: boolean) => { setLocal(v); onOpenChange && onOpenChange(v); };
  return <DialogCtx.Provider value={{ open: local, setOpen }}>{children}</DialogCtx.Provider>;
}
export function DialogTrigger({ asChild, children }: any) {
  const ctx = useContext(DialogCtx)!; if (!asChild) return null; return cloneElement(children, { onClick: () => ctx.setOpen(true) });
}
export function DialogContent({ className, children }: any) {
  const ctx = useContext(DialogCtx)!; if (!ctx?.open) return null; return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">
      <div className="absolute inset-0 bg-black/40" onClick={() => ctx.setOpen(false)} />
      <div className={cn("relative z-10 w-full max-w-xl rounded-2xl border bg-background p-4", className)}>{children}</div>
    </div>
  );
}
export function DialogHeader({ className, ...props }: any) { return <div className={cn("mb-2", className)} {...props} />; }
export function DialogTitle({ className, ...props }: any) { return <h4 className={cn("text-base font-semibold", className)} {...props} />; }

// --- Simple Sheet ---
const SheetCtx = createContext<{ open: boolean; setOpen: (v: boolean) => void } | null>(null);
export function Sheet({ children }: any) { const [open, setOpen] = useState(false); return <SheetCtx.Provider value={{ open, setOpen }}>{children}</SheetCtx.Provider>; }
export function SheetTrigger({ asChild, children }: any) { const ctx = useContext(SheetCtx)!; return cloneElement(children, { onClick: () => ctx.setOpen(true) }); }
export function SheetContent({ className, children }: any) {
  const ctx = useContext(SheetCtx)!; if (!ctx?.open) return null; return (
    <div className="fixed inset-0 z-50">
      <div className="absolute inset-0 bg-black/40" onClick={() => ctx.setOpen(false)} />
      <div className={cn("absolute right-0 top-0 h-full w-[420px] max-w-full border-l bg-background p-4", className)}>{children}</div>
    </div>
  );
}
export function SheetHeader({ className, ...props }: any) { return <div className={cn("mb-2", className)} {...props} />; }
export function SheetTitle({ className, ...props }: any) { return <h4 className={cn("text-base font-semibold", className)} {...props} />; }



// ============================================================
// Optimized header with non-blocking avatar
// ============================================================
const PLACEHOLDER_AVATAR =
  "data:image/svg+xml;utf8,\n  <svg xmlns='http://www.w3.org/2000/svg' width='96' height='96'>\n    <rect width='100%' height='100%' fill='%23eee'/>\n    <text x='50%' y='56%' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-size='24'>--</text>\n  </svg>";

const PageHeaderBannerAvatar = memo(function PageHeaderBannerAvatar({
  name,
  email,
  avatarUrl,
}: {
  name: string;
  email: string;
  avatarUrl?: string;
}) {
  const [src, setSrc] = useState<string>(PLACEHOLDER_AVATAR);
  useEffect(() => {
    const realSrc = avatarUrl;
    if (!realSrc) return;
    const load = () => setSrc(realSrc);
    if ("requestIdleCallback" in window) {
      (window as any).requestIdleCallback(load, { timeout: 800 });
    } else {
      requestAnimationFrame(load);
    }
  }, [avatarUrl]);

  return (
    <div className="relative flex flex-col px-1 pt-1">
      {/* Gradient banner */}
      <div className="h-40 w-full rounded-xl bg-gradient-to-t from-[#FBC5EC] to-[#A5C0EE] lg:h-60" />

      {/* Content row */}
      <div className="m-auto -mt-12 w-full px-3 lg:-mt-10 lg:px-8">
        <div className="flex flex-col gap-4 border-b pb-4 lg:flex-row lg:gap-5 lg:pb-6">
          {/* Avatar + back on mobile */}
          <div className="flex items-start justify-between">
            <Avatar className="h-16 w-16 lg:hidden">
              <AvatarImage src={src} alt={name} />
              <AvatarFallback>{name.slice(0, 2)}</AvatarFallback>
            </Avatar>
            <Avatar className="hidden h-24 w-24 lg:block">
              <AvatarImage src={src} alt={name} />
              <AvatarFallback>{name.slice(0, 2)}</AvatarFallback>
            </Avatar>
            <Button variant="link" size="sm" className="translate-y-2 self-end lg:hidden gap-1">
              <ArrowLeft className="h-4 w-4" /> Back
            </Button>
          </div>

          {/* Title + actions */}
          <div className="flex w-full flex-col gap-x-4 gap-y-5 lg:pt-16">
            {/* Breadcrumbs (simple) */}
            <div className="hidden items-center gap-2 text-sm text-muted-foreground lg:flex">
              <Home className="h-4 w-4" />
              <span>/</span>
              <span>Dashboard</span>
              <span>/</span>
              <span className="text-foreground">Home</span>
            </div>

            <div className="flex flex-1 flex-col flex-wrap gap-4 lg:flex-row">
              <div className="flex min-w-60 flex-1 flex-col gap-0.5 lg:gap-1">
                <h1 className="text-xl font-semibold lg:text-3xl">{name}</h1>
                <p className="text-sm text-muted-foreground">{email}</p>
              </div>
              <div className="flex gap-3">
                <Button variant="secondary" className="hidden lg:inline-flex">Tertiary</Button>
                <Button variant="secondary">Secondary</Button>
                <Button>Primary</Button>
              </div>
              <div className="relative max-w-80 min-w-48 flex-1">
                <Input className="pl-9" placeholder="Search" aria-label="Search" />
                <div className="absolute left-3 top-2.5 h-4 w-4 text-muted-foreground">üîç</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
});

// ---------- Mock data ----------
const me = {
  name: "Olivia Rhye",
  email: "olivia@untitledui.com",
  avatar: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=256&auto=format&fit=crop",
  location: "Fort Collins, CO",
  age: 17,
  utr: 7.8,
  usta: 1453,
  nsl: 212,
  utrTrend: "positive" as "positive" | "negative",
  ustaTrend: "negative" as "positive" | "negative",
  nslTrend: "positive" as "positive" | "negative",
};

// Comprehensive tennis stats data
const tennisStats = {
  utr: {
    current: 7.8,
    trend: "+0.2",
    trendDirection: "positive" as "positive" | "negative",
    history: [
      { date: "2024-01", rating: 7.2 },
      { date: "2024-02", rating: 7.3 },
      { date: "2024-03", rating: 7.4 },
      { date: "2024-04", rating: 7.5 },
      { date: "2024-05", rating: 7.6 },
      { date: "2024-06", rating: 7.7 },
      { date: "2024-07", rating: 7.8 },
    ],
    matches: {
      total: 47,
      wins: 32,
      losses: 15,
      winRate: "68%",
      lastMatch: "2024-07-28",
      lastResult: "W 6-4, 6-4",
      lastOpponent: "J. Cruz (UTR 7.2)",
      lastUtrChange: "+0.2"
    },
    tournaments: {
      total: 12,
      titles: 3,
      finals: 5,
      semifinals: 2,
      quarterfinals: 2
    },
    surfaces: {
      hard: { matches: 28, winRate: "71%" },
      clay: { matches: 12, winRate: "67%" },
      grass: { matches: 7, winRate: "57%" }
    },
    styles: {
      aggressive: { matches: 25, winRate: "72%" },
      defensive: { matches: 15, winRate: "60%" },
      allCourt: { matches: 7, winRate: "71%" }
    }
  },
  usta: {
    current: 1453,
    trend: "-12",
    trendDirection: "negative" as "positive" | "negative",
    ranking: "State: #23 | Section: #156 | National: #1,247",
    history: [
      { date: "2024-01", points: 1480 },
      { date: "2024-02", points: 1475 },
      { date: "2024-03", points: 1470 },
      { date: "2024-04", points: 1465 },
      { date: "2024-05", points: 1460 },
      { date: "2024-06", points: 1455 },
      { date: "2024-07", points: 1453 },
    ],
    events: {
      total: 18,
      wins: 12,
      losses: 6,
      winRate: "67%",
      lastEvent: "USTA L6 Poudre Open",
      lastFinish: "Quarterfinals",
      lastDate: "2024-07-21"
    },
    ageGroups: {
      "16U": { ranking: "#15", points: 1453 },
      "18U": { ranking: "#23", points: 1453 }
    }
  },
  nsl: {
    current: 212,
    trend: "+8",
    trendDirection: "positive" as "positive" | "negative",
    ranking: "National: #212 | Regional: #18 | State: #3",
    history: [
      { date: "2024-01", ranking: 245 },
      { date: "2024-02", ranking: 238 },
      { date: "2024-03", ranking: 230 },
      { date: "2024-04", rating: 225 },
      { date: "2024-05", ranking: 220 },
      { date: "2024-06", ranking: 215 },
      { date: "2024-07", ranking: 212 },
    ],
    ladder: {
      total: 24,
      wins: 18,
      losses: 6,
      winRate: "75%",
      currentStreak: 4,
      bestStreak: 7
    }
  },
  performance: {
    serve: {
      firstServe: "68%",
      firstServeWon: "72%",
      secondServeWon: "54%",
      aces: 47,
      doubleFaults: 23,
      aceRate: "12%"
    },
    return: {
      firstServeReturnWon: "28%",
      secondServeReturnWon: "52%",
      breakPointsConverted: "41%",
      returnGamesWon: "35%"
    },
    overall: {
      gamesWon: "58%",
      setsWon: "62%",
      matchesWon: "68%",
      tiebreaks: "55%"
    }
  },
  fitness: {
    endurance: "8.2/10",
    speed: "7.8/10",
    agility: "8.0/10",
    strength: "7.5/10",
    flexibility: "8.5/10"
  },
  goals: {
    shortTerm: "Reach UTR 8.0 by end of 2024",
    mediumTerm: "Win USTA L5 tournament",
    longTerm: "College tennis scholarship",
    progress: {
      utr: { current: 7.8, target: 8.0, percentage: 75 },
      usta: { current: 1453, target: 1500, percentage: 65 },
      nsl: { current: 212, target: 200, percentage: 80 }
    }
  }
};

const suggestedPlayers = [
  { id: 1, name: "Maya Patel", utr: 7.5, location: "Longmont, CO", handed: "Right", style: "Aggressive Baseliner" },
  { id: 2, name: "Dylan Park", utr: 8.1, location: "Loveland, CO", handed: "Left", style: "All Court" },
  { id: 3, name: "Leo Campos", utr: 7.9, location: "Greeley, CO", handed: "Right", style: "Counterpuncher" },
];

const upcomingEvents = [
  { id: 11, name: "USTA L5 Summer Slam", date: "Aug 24", city: "Denver", surface: "Hard" },
  { id: 12, name: "Northern CO UTR 8", date: "Sep 02", city: "Fort Collins", surface: "Hard" },
];

const journey = [
  { id: "j1", type: "match", title: "Won 6-4 6-4 vs J. Cruz", date: "Jul 28", meta: "UTR Verified", result: "W", utrChange: "+0.2" },
  { id: "j2", type: "event", title: "Quarterfinals at L6 Poudre Open", date: "Jul 21", meta: "3 matches", finish: "QF", matches: 3 },
  { id: "j3", type: "training", title: "AI session: Serve toss drift", date: "Jul 18", meta: "Drill plan saved", duration: "45m", saved: "Drill Plan" },
  { id: "j4", type: "match", title: "Lost 7-6(5) 6-3 to M. Zhou", date: "Jul 15", meta: "UTR Verified", result: "L", utrChange: "-0.1" },
  { id: "j5", type: "event", title: "Semifinals at UTR 7.5+ Challenge", date: "Jul 10", meta: "4 matches", finish: "SF", matches: 4 },
  { id: "j6", type: "training", title: "AI session: Backhand consistency", date: "Jul 08", meta: "Progress tracked", duration: "60m", saved: "Progress" },
];

// NEW: Define allPlayers used by <Players/>
interface Player { id: number; name: string; location: string; utr: number; usta: number; nsl: number; dominant?: "L"|"R" }
const allPlayers: Player[] = [
  { id: 101, name: "Maya Patel", location: "Longmont, CO", utr: 7.5, usta: 1660, nsl: 230, dominant: "R" },
  { id: 102, name: "Dylan Park", location: "Loveland, CO", utr: 8.1, usta: 1104, nsl: 180, dominant: "L" },
  { id: 103, name: "Leo Campos", location: "Greeley, CO", utr: 7.9, usta: 1322, nsl: 205, dominant: "R" },
  { id: 104, name: "Maddie Zhou", location: "Boulder, CO", utr: 8.3, usta: 990, nsl: 160, dominant: "R" },
  { id: 105, name: "J. Cruz", location: "Denver, CO", utr: 7.2, usta: 1820, nsl: 260, dominant: "R" },
];

// ---------- Helper UI ----------
const Metric = memo(function Metric({ label, value, sub, trend }: { label: string; value: React.ReactNode; sub?: string; trend?: "positive" | "negative" }) {
  const TrendIcon = trend === "positive" ? TrendingUp : trend === "negative" ? TrendingDown : null;
  const trendColor = trend === "positive" ? "text-green-600" : trend === "negative" ? "text-red-600" : "";
  
  return (
    <Card className="shadow-sm">
      <CardHeader className="py-4">
        <CardDescription className="text-xs uppercase tracking-wide text-muted-foreground">{label}</CardDescription>
        <div className="flex items-center gap-2">
          <CardTitle className="text-2xl">{value}</CardTitle>
          {TrendIcon && <TrendIcon className={`h-5 w-5 ${trendColor}`} />}
        </div>
        {sub && !trend && <p className="text-sm text-muted-foreground">{sub}</p>}
      </CardHeader>
    </Card>
  );
});

const JourneyItem = memo(function JourneyItem({ item }: { item: { id: string; type: string; title: string; date: string; meta?: string } }) {
  const icon = item.type === "match" ? <Trophy className="h-4 w-4" /> : item.type === "event" ? <Calendar className="h-4 w-4" /> : <Sparkles className="h-4 w-4" />;
  return (
    <div className="relative pl-6">
      <div className="absolute left-0 top-1.5 h-3 w-3 rounded-full bg-primary" />
      <div className="ml-2 flex items-start gap-2">
        <div className="mt-0.5 text-muted-foreground">{icon}</div>
        <div>
          <div className="text-sm font-medium">{item.title}</div>
          <div className="text-xs text-muted-foreground">{item.date}{item.meta ? ` ‚Ä¢ ${item.meta}` : ""}</div>
        </div>
      </div>
    </div>
  );
});



// ---------- Pages ----------
function Landing({ statsDrawerOpen, setStatsDrawerOpen }: { statsDrawerOpen: boolean; setStatsDrawerOpen: (open: boolean) => void }) {
  // Defer heavy lists until after first paint
  const [mounted, setMounted] = useState(false);
  useEffect(() => {
    let raf1: number | null = null;
    let raf2: number | null = null;
    const delay = 220; // ms shimmer delay for smoother perception
    const id = setTimeout(() => {
      raf1 = requestAnimationFrame(() => {
        raf2 = requestAnimationFrame(() => setMounted(true));
      });
    }, delay);
    return () => {
      clearTimeout(id);
      if (raf1) cancelAnimationFrame(raf1);
      if (raf2) cancelAnimationFrame(raf2);
    };
  }, []);

  return (
    <div className="space-y-6">
      {/* Page Header */}
      <PageHeaderBannerAvatar name={me.name} email={me.email} avatarUrl={me.avatar} />

      {/* View All Stats Button */}
      <div className="flex items-center justify-between">
        <h2 className="text-xl font-semibold text-gray-900">Your ratings</h2>
        <Button 
          variant="outline" 
          className="gap-2 border-2 px-6 py-2"
          onClick={() => setStatsDrawerOpen(true)}
        >
          <BarChart2 className="h-4 w-4" />
          View all
        </Button>
          <StatsDrawerContent>
            <StatsDrawerHeader>
              <div className="flex items-center justify-between">
                <StatsDrawerTitle>Complete Tennis Statistics</StatsDrawerTitle>
                <StatsDrawerCloseButton />
              </div>
              <p className="text-sm text-muted-foreground mt-2">Comprehensive UTR, USTA, and performance data</p>
            </StatsDrawerHeader>
            <StatsDrawerBody>
              <div className="space-y-6">
                {/* UTR Section */}
                <div>
                  <h4 className="text-lg font-semibold mb-3 flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-blue-500"></div>
                    UTR Rating
                  </h4>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <Card className="p-3">
                      <div className="text-2xl font-bold text-blue-600">{tennisStats.utr.current}</div>
                      <div className="text-xs text-muted-foreground">Current Rating</div>
                    </Card>
                    <Card className="p-3">
                      <div className={`text-lg font-semibold ${tennisStats.utr.trendDirection === 'positive' ? 'text-green-600' : 'text-red-600'}`}>
                        {tennisStats.utr.trend}
                      </div>
                      <div className="text-xs text-muted-foreground">Last Change</div>
                    </Card>
                  </div>
                  <div className="space-y-3">
                    <div className="flex justify-between text-sm">
                      <span>Total Matches</span>
                      <span className="font-medium">{tennisStats.utr.matches.total}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>Win Rate</span>
                      <span className="font-medium text-green-600">{tennisStats.utr.matches.winRate}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>Tournaments</span>
                      <span className="font-medium">{tennisStats.utr.tournaments.total}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>Titles</span>
                      <span className="font-medium text-yellow-600">{tennisStats.utr.tournaments.titles}</span>
                    </div>
                  </div>
                </div>

                {/* USTA Section */}
                <div>
                  <h4 className="text-lg font-semibold mb-3 flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-green-500"></div>
                    USTA Rankings
                  </h4>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <Card className="p-3">
                      <div className="text-2xl font-bold text-green-600">{tennisStats.usta.current}</div>
                      <div className="text-xs text-muted-foreground">Points</div>
                    </Card>
                    <Card className="p-3">
                      <div className={`text-lg font-semibold ${tennisStats.usta.trendDirection === 'positive' ? 'text-green-600' : 'text-red-600'}`}>
                        {tennisStats.usta.trend}
                      </div>
                      <div className="text-xs text-muted-foreground">Point Change</div>
                    </Card>
                  </div>
                  <div className="text-sm text-muted-foreground mb-3">{tennisStats.usta.ranking}</div>
                  <div className="space-y-3">
                    <div className="flex justify-between text-sm">
                      <span>Total Events</span>
                      <span className="font-medium">{tennisStats.usta.events.total}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>Event Win Rate</span>
                      <span className="font-medium text-green-600">{tennisStats.usta.events.winRate}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>16U Ranking</span>
                      <span className="font-medium">{tennisStats.usta.ageGroups["16U"].ranking}</span>
                    </div>
                  </div>
                </div>

                {/* NSL Section */}
                <div>
                  <h4 className="text-lg font-semibold mb-3 flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-purple-500"></div>
                    NSL Ladder
                  </h4>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <Card className="p-3">
                      <div className="text-2xl font-bold text-purple-600">#{tennisStats.nsl.current}</div>
                      <div className="text-xs text-muted-foreground">National Rank</div>
                    </Card>
                    <Card className="p-3">
                      <div className={`text-lg font-semibold ${tennisStats.nsl.trendDirection === 'positive' ? 'text-green-600' : 'text-red-600'}`}>
                        {tennisStats.nsl.trend}
                      </div>
                      <div className="text-xs text-muted-foreground">Rank Change</div>
                    </Card>
                  </div>
                  <div className="space-y-3">
                    <div className="flex justify-between text-sm">
                      <span>Ladder Matches</span>
                      <span className="font-medium">{tennisStats.nsl.ladder.total}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>Ladder Win Rate</span>
                      <span className="font-medium text-green-600">{tennisStats.nsl.ladder.winRate}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span>Current Streak</span>
                      <span className="font-medium text-blue-600">{tennisStats.nsl.ladder.currentStreak}</span>
                    </div>
                  </div>
                </div>

                {/* Performance Stats */}
                <div>
                  <h4 className="text-lg font-semibold mb-3 flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-orange-500"></div>
                    Performance Metrics
                  </h4>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <div className="space-y-2">
                      <div className="text-sm font-medium">Serve</div>
                      <div className="text-xs space-y-1">
                        <div className="flex justify-between">
                          <span>1st Serve</span>
                          <span className="font-medium">{tennisStats.performance.serve.firstServe}</span>
                        </div>
                        <div className="flex justify-between">
                          <span>1st Won</span>
                          <span className="font-medium">{tennisStats.performance.serve.firstServeWon}</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Aces</span>
                          <span className="font-medium">{tennisStats.performance.serve.aces}</span>
                        </div>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="text-sm font-medium">Return</div>
                      <div className="text-xs space-y-1">
                        <div className="flex justify-between">
                          <span>Break Points</span>
                          <span className="font-medium">{tennisStats.performance.return.breakPointsConverted}</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Return Games</span>
                          <span className="font-medium">{tennisStats.performance.return.returnGamesWon}</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Overall Games</span>
                          <span className="font-medium">{tennisStats.performance.overall.gamesWon}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Fitness & Goals */}
                <div>
                  <h4 className="text-lg font-semibold mb-3 flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-pink-500"></div>
                    Fitness & Goals
                  </h4>
                  <div className="grid grid-cols-2 gap-3 mb-4">
                    <div className="space-y-2">
                      <div className="text-sm font-medium">Fitness Scores</div>
                      <div className="text-xs space-y-1">
                        <div className="flex justify-between">
                          <span>Endurance</span>
                          <span className="font-medium">{tennisStats.fitness.endurance}</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Speed</span>
                          <span className="font-medium">{tennisStats.fitness.speed}</span>
                        </div>
                        <div className="flex justify-between">
                          <span>Agility</span>
                          <span className="font-medium">{tennisStats.fitness.agility}</span>
                        </div>
                      </div>
                    </div>
                    <div className="space-y-2">
                      <div className="text-sm font-medium">Goal Progress</div>
                      <div className="text-xs space-y-1">
                        <div className="flex justify-between">
                          <span>UTR 8.0</span>
                          <span className="font-medium">{tennisStats.goals.progress.utr.percentage}%</span>
                        </div>
                        <div className="flex justify-between">
                          <span>USTA 1500</span>
                          <span className="font-medium">{tennisStats.goals.progress.usta.percentage}%</span>
                        </div>
                        <div className="flex justify-between">
                          <span>NSL Top 200</span>
                          <span className="font-medium">{tennisStats.goals.progress.nsl.percentage}%</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Recent Activity */}
                <div>
                  <h4 className="text-lg font-semibold mb-3 flex items-center gap-2">
                    <div className="w-3 h-3 rounded-full bg-indigo-500"></div>
                    Recent Activity
                  </h4>
                  <div className="space-y-3">
                    <div className="flex items-center justify-between text-sm p-2 bg-blue-50 rounded-lg">
                      <div>
                        <div className="font-medium">Last Match</div>
                        <div className="text-xs text-muted-foreground">{tennisStats.utr.matches.lastMatch}</div>
                      </div>
                      <div className="text-right">
                        <div className="font-medium text-green-600">{tennisStats.utr.matches.lastResult}</div>
                        <div className="text-xs text-muted-foreground">{tennisStats.utr.matches.lastUtrChange}</div>
                      </div>
                    </div>
                    <div className="flex items-center justify-between text-sm p-2 bg-green-50 rounded-lg">
                      <div>
                        <div className="font-medium">Last Tournament</div>
                        <div className="text-xs text-muted-foreground">{tennisStats.usta.events.lastDate}</div>
                      </div>
                      <div className="text-right">
                        <div className="font-medium text-orange-600">{tennisStats.usta.events.lastFinish}</div>
                        <div className="text-xs text-muted-foreground">{tennisStats.usta.events.lastEvent}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </StatsDrawerBody>
          </StatsDrawerContent>
        </StatsDrawer>
      </div>

      {/* Player Rankings Metrics */}
      <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
        <Metric label="UTR Rating" value={me.utr} sub="Universal Tennis Rating" trend={me.utrTrend} />
        <Metric label="USTA Ranking" value={me.usta} sub="United States Tennis Association" trend={me.ustaTrend} />
        <Metric label="NSL Ranking" value={me.nsl} sub="National Singles Ladder" trend={me.nslTrend} />
      </div>

      {/* Journey timeline - Full width */}
      <Card className="col-span-1 lg:col-span-3 shadow-sm overflow-hidden">
        <CardHeader className="border-b bg-gradient-to-r from-blue-50 to-indigo-50">
          <div className="flex items-center justify-between">
            <div>
              <CardTitle className="text-xl text-gray-900">Your Tennis Journey</CardTitle>
              <CardDescription className="text-sm text-gray-600">Track your progress, achievements, and growth as a player</CardDescription>
            </div>
            <Button variant="outline" className="gap-2 border-2 px-4 py-2">
              <BarChart2 className="h-4 w-4" />
              View Full Journey
            </Button>
          </div>
        </CardHeader>
        <CardContent className="p-0">
          <div className="relative">
            {/* Timeline line */}
            <div className="absolute left-8 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-200 via-indigo-200 to-purple-200 animate-pulse"></div>
            
            <div className="space-y-0">
              {mounted ? (
                journey.map((j, index) => (
                  <div key={j.id} className="relative group hover:bg-gray-50 transition-colors">
                    {/* Timeline dot */}
                    <div className={`absolute left-6 top-6 w-4 h-4 rounded-full border-4 border-white shadow-lg z-10 ${
                      j.type === "match" ? "bg-gradient-to-r from-green-500 to-emerald-500" :
                      j.type === "event" ? "bg-gradient-to-r from-orange-500 to-amber-500" :
                      "bg-gradient-to-r from-purple-500 to-pink-500"
                    }`}></div>
                    
                    <div className="pl-20 pr-6 py-6">
                      <div className="flex items-start justify-between">
                        <div className="flex-1">
                          <div className="flex items-center gap-3 mb-2">
                            <div className={`flex items-center justify-center w-8 h-8 rounded-lg ${
                              j.type === "match" ? "bg-gradient-to-r from-green-100 to-emerald-100" :
                              j.type === "event" ? "bg-gradient-to-r from-orange-100 to-amber-100" :
                              "bg-gradient-to-r from-purple-100 to-pink-100"
                            }`}>
                              {j.type === "match" ? <Trophy className="h-4 w-4 text-green-600" /> : 
                               j.type === "event" ? <Calendar className="h-4 w-4 text-orange-600" /> : 
                               <Sparkles className="h-4 w-4 text-purple-600" />}
                            </div>
                            <div>
                              <h4 className="font-semibold text-gray-900">{j.title}</h4>
                              <p className="text-sm text-gray-500">{j.date}</p>
                            </div>
                          </div>
                          {j.meta && (
                            <div className="flex items-center gap-2">
                              <Badge variant="secondary" className="text-xs px-2 py-1 bg-blue-50 text-blue-700 border-blue-200">
                                {j.meta}
                              </Badge>
                            </div>
                          )}
                        </div>
                        
                        {/* Journey stats preview */}
                        <div className="hidden lg:flex items-center gap-4 text-sm text-gray-500">
                          {j.type === "match" && (
                            <>
                              <div className="text-center">
                                <div className={`font-semibold ${j.result === "W" ? "text-green-600" : "text-red-600"}`}>
                                  {j.result}
                                </div>
                                <div className="text-xs">Result</div>
                              </div>
                              <div className="text-center">
                                <div className={`font-semibold ${j.utrChange?.startsWith("+") ? "text-green-600" : "text-red-600"}`}>
                                  {j.utrChange}
                                </div>
                                <div className="text-xs">UTR</div>
                              </div>
                            </>
                          )}
                          {j.type === "event" && (
                            <>
                              <div className="text-center">
                                <div className="font-semibold text-orange-600">{j.finish}</div>
                                <div className="text-xs">Finish</div>
                              </div>
                              <div className="text-center">
                                <div className="font-semibold text-blue-600">{j.matches}</div>
                                <div className="text-xs">Matches</div>
                              </div>
                            </>
                          )}
                          {j.type === "training" && (
                            <>
                              <div className="text-center">
                                <div className="font-semibold text-purple-600">{j.duration}</div>
                                <div className="text-xs">Duration</div>
                              </div>
                              <div className="text-center">
                                <div className="font-semibold text-green-600">{j.saved}</div>
                                <div className="text-xs">Saved</div>
                              </div>
                            </>
                          )}
                        </div>
                      </div>
                    </div>
                    
                    {/* Hover effect line */}
                    <div className="absolute left-8 top-0 bottom-0 w-0.5 bg-transparent group-hover:bg-gradient-to-b group-hover:from-blue-400 group-hover:to-indigo-400 transition-all duration-300"></div>
                  </div>
                ))
              ) : (
                <div className="p-6">
                  <SkeletonLines count={3} />
                </div>
              )}
            </div>
            
            {/* Journey progress indicator */}
            <div className="px-6 py-4 bg-gradient-to-r from-gray-50 to-blue-50 border-t">
              <div className="flex items-center justify-between text-sm">
                <div className="flex items-center gap-2">
                  <div className="w-2 h-2 rounded-full bg-green-500"></div>
                  <span className="text-gray-600">Journey in progress</span>
                </div>
                <div className="flex items-center gap-4">
                  <span className="text-gray-500">Next milestone: UTR 8.0</span>
                  <div className="w-24 h-2 bg-gray-200 rounded-full overflow-hidden">
                    <div className="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full" style={{width: '75%'}}></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* AI Coaching CTA */}
      <Card className="shadow-sm">
        <CardHeader>
          <CardTitle className="text-lg">Upload a video for AI coaching</CardTitle>
          <CardDescription>Drag and drop or choose a file. We analyze form, footwork, and tactics.</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="rounded-xl border border-dashed p-6 text-center">
            <Video className="mx-auto mb-2 h-6 w-6" />
            <p className="text-sm mb-3 text-muted-foreground">.mp4, .mov up to 1 GB</p>
            <div className="flex items-center justify-center gap-2">
              <Button variant="secondary" className="gap-2"><Upload className="h-4 w-4" />Upload</Button>
              <Button variant="ghost" className="gap-2"><Paperclip className="h-4 w-4" />Attach URL</Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Suggested matches */}
      <Card className="shadow-sm">
        <CardHeader className="flex-row items-center justify-between">
          <div>
            <CardTitle className="text-lg">Suggested matches</CardTitle>
            <CardDescription>Players near your UTR and location</CardDescription>
          </div>
        </CardHeader>
        <CardContent className="space-y-3">
          {mounted ? (
            suggestedPlayers.map((p) => (
              <div key={p.id} className="flex items-center justify-between rounded-lg border p-3">
                <div className="flex items-center gap-3">
                  <Avatar className="h-8 w-8"><AvatarFallback>{p.name.slice(0,2)}</AvatarFallback></Avatar>
                  <div>
                    <div className="text-sm font-medium">{p.name}</div>
                    <div className="text-xs text-muted-foreground">UTR {p.utr} ‚Ä¢ {p.location}</div>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <Badge>Invite</Badge>
                  <Button size="sm" className="gap-1">Request match</Button>
                </div>
              </div>
            ))
          ) : (
            <SkeletonCards count={3} />
          )}
        </CardContent>
      </Card>

      {/* Suggested events */}
      <Card className="shadow-sm">
        <CardHeader>
          <CardTitle className="text-lg">Suggested events</CardTitle>
          <CardDescription>Based on your UTR, rankings, and distance</CardDescription>
        </CardHeader>
        <CardContent className="space-y-3">
          {mounted ? (
            upcomingEvents.map((e) => (
              <div key={e.id} className="flex items-center justify-between rounded-lg border p-3">
                <div>
                  <div className="text-sm font-medium">{e.name}</div>
                  <div className="text-xs text-muted-foreground">{e.date} ‚Ä¢ {e.city} ‚Ä¢ {e.surface}</div>
                </div>
                <Button size="sm" variant="secondary" className="gap-1"><Calendar className="h-4 w-4" />View</Button>
              </div>
            ))
          ) : (
            <SkeletonCards count={2} />
          )}
        </CardContent>
      </Card>
    </div>
  );
}

function Players() {
  const [q, setQ] = useState("");
  const list = useMemo(() => allPlayers.filter(p => p.name.toLowerCase().includes(q.toLowerCase())), [q]);
  const [compareIds, setCompareIds] = useState<number[]>([]);
  const compare = allPlayers.filter(p => compareIds.includes(p.id));

  return (
    <div className="space-y-4">
      <Card className="shadow-sm">
        <CardHeader className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
          <div>
            <CardTitle>Player search</CardTitle>
            <CardDescription>Browse, filter, and request matches</CardDescription>
          </div>
          <div className="flex items-center gap-2">
            <Input value={q} onChange={(e: React.ChangeEvent<HTMLInputElement>) => setQ(e.target.value)} placeholder="Search players" className="w-56" />
            <Button variant="secondary" className="gap-2">Filters</Button>
          </div>
        </CardHeader>
      </Card>

      <div className="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-3">
        {list.map(p => (
          <Card key={p.id} className="shadow-sm">
            <CardHeader className="flex-row items-center gap-3">
              <Avatar className="h-10 w-10"><AvatarFallback>{p.name.slice(0,2)}</AvatarFallback></Avatar>
              <div className="flex-1">
                <CardTitle className="text-base">{p.name}</CardTitle>
                <CardDescription className="flex items-center gap-1 text-xs"><MapPin className="h-3 w-3" />{p.location}</CardDescription>
              </div>
              <Button variant={compareIds.includes(p.id) ? "default" : "secondary"} size="sm" onClick={() => setCompareIds(prev => prev.includes(p.id) ? prev.filter(id => id !== p.id) : [...prev, p.id])}>{compareIds.includes(p.id) ? "Selected" : "Compare"}</Button>
            </CardHeader>
            <CardContent className="flex items-center justify-between gap-3">
              <div className="grid grid-cols-3 gap-3">
                <Metric label="UTR" value={p.utr} />
                <Metric label="USTA" value={p.usta} />
                <Metric label="NSL" value={p.nsl} />
              </div>
              <Button className="gap-2">Request match</Button>
            </CardContent>
          </Card>
        ))}
      </div>

      <Dialog>
        <DialogTrigger asChild>
          <Button disabled={compare.length < 2} className="gap-2"><BarChart2 className="h-4 w-4" />Compare {compare.length} players</Button>
        </DialogTrigger>
        <DialogContent className="max-w-3xl">
          <DialogHeader>
            <DialogTitle>Head to head</DialogTitle>
          </DialogHeader>
          <div className="grid grid-cols-1 gap-4 md:grid-cols-3">
            {compare.map(p => (
              <Card key={p.id} className="shadow-sm">
                <CardHeader className="items-center">
                  <Avatar className="h-12 w-12"><AvatarFallback>{p.name.slice(0,2)}</AvatarFallback></Avatar>
                  <CardTitle className="text-base mt-2">{p.name}</CardTitle>
                  <CardDescription>UTR {p.utr} ‚Ä¢ USTA {p.usta} ‚Ä¢ NSL {p.nsl}</CardDescription>
                </CardHeader>
              </Card>
            ))}
          </div>
        </DialogContent>
      </Dialog>
    </div>
  );
}

function Coaching() {
  const [messages, setMessages] = useState([
    { role: "system", content: "Welcome back, Olivia. Upload a clip or ask a question to continue." },
    { role: "user", content: "Can you analyze my slice serve toss from last match?" },
    { role: "assistant", content: "Your toss is landing a foot right of ideal. Try this drill: knee bend pause, 10 reps, focus on contact in front." },
  ]);
  const [input, setInput] = useState("");

  function send() {
    if (!input.trim()) return;
    setMessages([...messages, { role: "user", content: input }]);
    setInput("");
  }

  return (
    <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
      <Card className="lg:col-span-2 shadow-sm">
        <CardHeader>
          <CardTitle>AI coaching</CardTitle>
          <CardDescription>Chat UX with video understanding</CardDescription>
        </CardHeader>
        <CardContent>
          <div className="h-[440px] overflow-y-auto rounded-lg border p-4 space-y-4 bg-muted/30">
            {messages.map((m, i) => (
              <div key={i} className={cn("flex", m.role === "user" ? "justify-end" : "justify-start") }>
                <div className={cn("max-w-[75%] rounded-2xl px-3 py-2 text-sm", m.role === "user" ? "bg-primary text-primary-foreground" : "bg-background border") }>
                  {m.content}
                </div>
              </div>
            ))}
          </div>
          <div className="mt-4 flex items-end gap-2">
            <Sheet>
              <SheetTrigger asChild>
                <Button variant="secondary" className="gap-2"><Upload className="h-4 w-4" />Upload video</Button>
              </SheetTrigger>
              <SheetContent className="w-[420px]">
                <SheetHeader>
                  <SheetTitle>Upload a clip</SheetTitle>
                </SheetHeader>
                <div className="mt-4 rounded-xl border border-dashed p-6 text-center">
                  <Video className="mx-auto mb-2 h-6 w-6" />
                  <p className="text-sm mb-3 text-muted-foreground">Drag and drop .mp4 or .mov up to 1 GB</p>
                  <Button className="gap-2"><Upload className="h-4 w-4" />Choose file</Button>
                </div>
              </SheetContent>
            </Sheet>
            <Textarea value={input} onChange={(e: React.ChangeEvent<HTMLTextAreaElement>) => setInput(e.target.value)} placeholder="Ask about technique, tactics, or fitness" className="resize-none" />
            <Button onClick={send} className="gap-1"><Sparkles className="h-4 w-4" />Send</Button>
          </div>
        </CardContent>
      </Card>

      <div className="space-y-4">
        <Card className="shadow-sm">
          <CardHeader>
            <CardTitle>Recent sessions</CardTitle>
            <CardDescription>Your clips and AI summaries</CardDescription>
          </CardHeader>
          <CardContent className="space-y-3">
            {[1,2,3].map(i => (
              <div key={i} className="rounded-lg border p-3">
                <div className="flex items-center justify-between">
                  <div className="text-sm font-medium">Serve mechanics ‚Ä¢ Clip {i}</div>
                  <Badge>Saved</Badge>
                </div>
                <div className="text-xs text-muted-foreground mt-1">Key notes: shoulder over shoulder, earlier contact, recover to center</div>
                <div className="mt-2 flex gap-2">
                  <Button variant="secondary" size="sm" className="gap-1"><MessageSquare className="h-4 w-4" />Open chat</Button>
                  <Button variant="ghost" size="sm">Download report</Button>
                </div>
              </div>
            ))}
          </CardContent>
        </Card>
      </div>
    </div>
  );
}

function Events() {
  return (
    <Card className="shadow-sm">
      <CardHeader>
        <CardTitle>Events</CardTitle>
        <CardDescription>Coming soon</CardDescription>
      </CardHeader>
      <CardContent>
        <div className="rounded-xl border border-dashed p-8 text-center text-muted-foreground">Tournament calendar and registrations are in progress.</div>
      </CardContent>
    </Card>
  );
}

function Settings() {
  return (
    <div className="grid grid-cols-1 gap-6 lg:grid-cols-3">
      <Card className="lg:col-span-2 shadow-sm">
        <CardHeader>
          <CardTitle>Profile</CardTitle>
          <CardDescription>Manage how others see you</CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <div className="grid grid-cols-1 gap-4 md:grid-cols-2">
            <div className="space-y-2">
              <Label>Full name</Label>
              <Input defaultValue={me.name} />
            </div>
            <div className="space-y-2">
              <Label>Email</Label>
              <Input defaultValue={me.email} />
            </div>
            <div className="space-y-2">
              <Label>Location</Label>
              <Input defaultValue={me.location} />
            </div>
            <div className="space-y-2">
              <Label>Age</Label>
              <Input defaultValue={me.age} type="number" />
            </div>
          </div>
          <Separator />
          <div className="flex items-center justify-between">
            <div>
              <div className="text-sm font-medium">Show profile in search</div>
              <div className="text-xs text-muted-foreground">Let others request matches</div>
            </div>
            <Switch defaultChecked />
          </div>
          <div className="flex items-center justify-between">
            <div>
              <div className="text-sm font-medium">Notifications</div>
              <div className="text-xs text-muted-foreground">Match requests and event reminders</div>
            </div>
            <Switch defaultChecked />
          </div>
          <div className="pt-2">
            <Button>Save changes</Button>
          </div>
        </CardContent>
      </Card>

      <Card className="shadow-sm">
        <CardHeader>
          <CardTitle>Connected accounts</CardTitle>
          <CardDescription>Link ranking providers</CardDescription>
        </CardHeader>
        <CardContent className="space-y-3">
          {[
            { name: "UTR", status: "Connected" },
            { name: "USTA", status: "Connect" },
            { name: "NSL", status: "Connect" },
          ].map((s) => (
            <div key={s.name} className="flex items-center justify-between rounded-lg border p-3">
              <div className="text-sm font-medium">{s.name}</div>
              <Button size="sm" variant={s.status === "Connected" ? "secondary" : "default"}>{s.status}</Button>
            </div>
          ))}
        </CardContent>
      </Card>
    </div>
  );
}

// ---------- App shell with Untitled UI style sidebar ----------

type Route = "home" | "players" | "coaching" | "events" | "settings";

export default function App() {
  const [route, setRoute] = useState<Route>("home");
  const [statsDrawerOpen, setStatsDrawerOpen] = useState(false);

  // DEV TESTS: Basic invariants to catch regressions (run once in dev)
  useEffect(() => {
    try {
      console.assert(Array.isArray(allPlayers) && allPlayers.length >= 4, "allPlayers should be a non-empty array");
      const maya = allPlayers.find(p => p.name.toLowerCase().includes("maya"));
      console.assert(!!maya && typeof maya!.utr === "number", "Players should have numeric UTR");
      const filtered = allPlayers.filter(p => p.name.toLowerCase().includes("a"));
      console.assert(filtered.length <= allPlayers.length, "Filter should not increase length");
    } catch (e) {
      console.warn("Dev tests failed:", e);
    }
  }, []);

  return (
    <div className="min-h-screen bg-background text-foreground">
      <div className="flex w-full h-screen">
        {/* Sidebar - Fixed width, always visible */}
        <Navigation route={route} setRoute={setRoute} user={me} />

        {/* Main content area - Fills remaining space */}
        <div className={`flex-1 flex flex-col min-w-0 transition-transform duration-300 ${statsDrawerOpen ? 'transform -translate-x-20' : ''}`}>
          {/* Mobile top bar */}
          <div className="md:hidden border-b bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/60">
            <div className="flex h-14 items-center justify-between px-4">
              <div className="flex items-center gap-2">
                <div className="h-8 w-8 rounded-xl bg-gradient-to-br from-indigo-200 to-purple-400" />
                <div className="text-base font-semibold">Untitled UI Tennis</div>
              </div>
              <MobileMenu route={route} setRoute={setRoute} />
            </div>
          </div>

          {/* Main content */}
          <main className="flex-1 overflow-auto">
            <div className="p-6 space-y-6">
              {route === "home" && <Landing statsDrawerOpen={statsDrawerOpen} setStatsDrawerOpen={setStatsDrawerOpen} />}
              {route === "players" && <Players />}
              {route === "coaching" && <Coaching />}
              {route === "events" && <Events />}
              {route === "settings" && <Settings />}
            </div>
          </main>
        </div>
      </div>
    </div>
  );
}

function MobileMenu({ route, setRoute }: { route: Route; setRoute: (r: Route) => void }) {
  const [open, setOpen] = useState(false);
  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button variant="outline" size="sm" className="gap-2"><ChevronDown className="h-4 w-4" />Menu</Button>
      </DialogTrigger>
      <DialogContent className="p-0">
        <div className="p-2">
          {([
            { key: "home", label: "Home" },
            { key: "players", label: "Players" },
            { key: "coaching", label: "AI Coaching" },
            { key: "events", label: "Events" },
            { key: "settings", label: "Settings" },
          ] as { key: Route; label: string }[]).map((i) => (
            <button key={i.key} onClick={() => { setRoute(i.key as Route); setOpen(false); }} className={cn("flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm", route === i.key ? "bg-muted" : "hover:bg-muted/60")}>
              <span>{i.label}</span>
            </button>
          ))}
        </div>
      </DialogContent>
    </Dialog>
  );
}

// ---------- Skeleton helpers ----------
function SkeletonLines({ count = 3 }: { count?: number }) {
  return (
    <div className="space-y-3">
      {Array.from({ length: count }).map((_, i) => (
        <div key={i} className="animate-pulse space-y-2">
          <div className="h-3 w-24 rounded bg-muted" />
          <div className="h-3 w-48 rounded bg-muted" />
        </div>
      ))}
    </div>
  );
}

function SkeletonCards({ count = 3 }: { count?: number }) {
  return (
    <div className="space-y-3">
      {Array.from({ length: count }).map((_, i) => (
        <div key={i} className="animate-pulse rounded-lg border p-3">
          <div className="flex items-center justify-between gap-3">
            <div className="flex items-center gap-3">
              <div className="h-8 w-8 rounded-full bg-muted" />
              <div className="space-y-2">
                <div className="h-3 w-24 rounded bg-muted" />
                <div className="h-3 w-40 rounded bg-muted" />
              </div>
            </div>
            <div className="h-8 w-20 rounded bg-muted" />
          </div>
        </div>
      ))}
    </div>
  );
}
